@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@using Microsoft.AspNetCore.Http
@inject IHttpContextAccessor HttpContextAccessor
@{
    ViewData["Title"] = "Product Page";
}

@model INF27507_Boutique_En_Ligne.Models.Product

<h1>Product</h1>

<div class="container">
    <div class="row mt-5 mb-5">
        <div class="col-md-6">
            <a href="@Model.ImageURL" target="_blank">
                <img 
                    class="img-fluid" 
                    src="~/img/@Model.Image" 
                    alt="@Model.Title"
                />
            </a>
        </div>
        <div class="col-md-6">
            <div class="container-fluid">
                <div class="row mb-4">
                    <h2>@Model.Title</h2>
                    <h5>Sold by : @Model.Seller.Firstname @Model.Seller.Lastname</h5>
                </div>
                <div class="row mb-4">
                    <h3>@Model.Price.ToString("C")</h3>
                </div>
                @{
                    int? userId = HttpContextAccessor.HttpContext.Session.GetInt32("UserId");
                    string? userType = HttpContextAccessor.HttpContext.Session.GetString("UserType");
                    if (userId != null && userType.Equals(UserType.Client.ToString()))
                    {
                        <form asp-controller="Cart" asp-action="Add" asp-route-id="@Model.Id" method="post">
                            <div class="row">
                                <div class="col-sm-4">
                                    <input type="number" class="form-control" min="1" max="25" value="1" name="itemQuantity" />
                                </div>
                                <div class="col-sm-4">
                                    <button type="submit" class="btn btn-primary">Add to cart</button>
                                </div>
                            </div>
                        </form>
                    }
                    else if (userId != null && 
                             userType.Equals(UserType.Seller.ToString()) &&
                             userId == @Model.SellerId)
                    {
                        <div class="row">
                            <div class="col-sm-3">
                                <form asp-controller="Product" asp-action="Edit" asp-route-id="@Model.Id" method="get">
                                    <button type="submit" class="btn btn-success btn-over-streched-link">Edit Product</button>
                                </form>
                            </div>
                            <div class="col-sm-9">
                                <form asp-controller="Product" asp-action="Delete" asp-route-id="@Model.Id" method="post">
                                    <button type="submit" class="btn btn-danger btn-over-streched-link">Delete Product</button>
                                </form>
                            </div>
                        </div>
                    }
                }
                <dl class="row mt-4">
                    <dt class="col-sm-6 col-lg-3">Category : </dt>
                    <dd class="col-sm-6 col-lg-9">@Model.Category.Name</dd>

                    <dt class="col-sm-6 col-lg-3">Subcategory : </dt>
                    <dd class="col-sm-6 col-lg-9">@Model.SubCategory.Name</dd>

                    <dt class="col-sm-6 col-lg-3">Product Type : </dt>
                    <dd class="col-sm-6 col-lg-9">@Model.ProductType.Name</dd>

                    <dt class="col mt-3">Additional information : </dt>
                    <dd>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item">Gender : @Model.Gender.Name</li>
                            <li class="list-group-item">Usage : @Model.Usage.Name</li>
                            <li class="list-group-item">Colour : @Model.Colour.Name</li>
                        </ul>
                    </dd>
                </dl>
            </div>
        </div>
    </div>
</div>